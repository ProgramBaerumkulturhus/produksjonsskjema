<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>Utfyllingsskjema</title>
  <style>
    body {
      font-family: "Century Gothic", sans-serif;
      margin: 40px;
      background: #fafafa;
      color: #222;
    }
    h2 { font-weight: 500; margin-bottom: 15px; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    th { background: #f2f2f2; }
    tr.weekend { background-color: #f9f1f4; }
    input, select {
      width: 100%; padding: 6px; border: none; background: transparent;
      font-family: inherit; font-size: 14px;
    }
    #saveBtn {
      margin-top: 20px; padding: 12px 24px; background: #67123b;
      color: white; border: none; border-radius: 6px;
      cursor: pointer; font-size: 15px;
    }
    #saveBtn:hover { background: #4c0d2b; }
    .toast {
      position: fixed; bottom: 30px; right: 30px;
      background: #4CAF50; color: white;
      padding: 15px 20px; border-radius: 8px;
      opacity: 0; transition: all 0.4s;
    }
    .toast.show { opacity: 1; }
  </style>
</head>

<body>
  <h2>Utfyllingsskjema â€“ <span id="prodTitle">Laster...</span></h2>

  <table id="data">
    <thead>
      <tr><th>Dato</th><th>Inn-tid</th><th>Ut-tid</th><th>Aktivitet</th></tr>
    </thead>
    <tbody><tr><td colspan="4">Laster data â€¦</td></tr></tbody>
  </table>

  <button id="saveBtn">Lagre endringer</button>
  <div id="toast" class="toast">Takk! Dine endringer er lagret.</div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const arkNavn = urlParams.get("ark");
    document.getElementById("prodTitle").textContent = arkNavn?.replace("Skjema - ", "") || "Ukjent";

    const scriptUrl = "https://script.google.com/macros/s/AKfycbwGPhWeBcdxWTthPMcNpzfGc5VljHJeYIodprTkGmlp0BOCJe-ddZ1Nc0fYsWpeYrMtYA/exec";

    async function loadData() {
      try {
        const res = await fetch(`${scriptUrl}?ark=${encodeURIComponent(arkNavn)}`, {
          method: "GET",
          headers: { "Content-Type": "application/json" },
          mode: "no-cors" // ðŸ‘ˆ viktig â€“ bypass CORS i GitHub Pages
        });

        // fordi no-cors gir opaque response, tester vi fallback:
        const text = await res.text();
        try {
          const data = JSON.parse(text);
          renderTable(data);
        } catch (err) {
          document.querySelector("#data tbody").innerHTML =
            `<tr><td colspan="4">Kunne ikke laste data (ugyldig JSON)</td></tr>`;
        }
      } catch (err) {
        document.querySelector("#data tbody").innerHTML =
          `<tr><td colspan="4">Kunne ikke laste data (${err})</td></tr>`;
      }
    }

    function renderTable(res) {
      const rows = res.rows || [];
      const tbody = document.querySelector("#data tbody");
      tbody.innerHTML = "";
      if (rows.length === 0) {
        tbody.innerHTML = "<tr><td colspan='4'>Ingen rader funnet</td></tr>";
        return;
      }

      rows.forEach(r => {
        const tr = document.createElement("tr");
        if (r.date.toLowerCase().includes("lÃ¸rdag") || r.date.toLowerCase().includes("sÃ¸ndag"))
          tr.classList.add("weekend");
        tr.innerHTML = `
          <td>${r.date}</td>
          <td><input type="text" value="${r.in || ""}"></td>
          <td><input type="text" value="${r.out || ""}"></td>
          <td><input type="text" value="${r.activity || ""}"></td>`;
        tbody.appendChild(tr);
      });
    }

    loadData();
  </script>
</body>
</html>
